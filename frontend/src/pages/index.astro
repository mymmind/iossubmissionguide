---
import Layout from '../layouts/Layout.astro';
import DOMPurify from 'isomorphic-dompurify';

const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3005';
let hubArticle = null;

try {
  const res = await fetch(`${apiUrl}/api/articles/app-store-guide`);
  if (res.ok) {
    hubArticle = await res.json();
  }
} catch (e) {
  console.error('Failed to fetch hub article:', e);
}

if (!hubArticle) {
  return Astro.redirect('/404');
}

// Sanitize HTML content to prevent XSS
const sanitizedContent = DOMPurify.sanitize(hubArticle.content, {
  ADD_TAGS: ['section'],
  ADD_ATTR: ['target', 'rel', 'onclick'],
});
---

<Layout title={hubArticle.title} description={hubArticle.description}>
  <article>
    <div set:html={sanitizedContent} />
  </article>
</Layout>
